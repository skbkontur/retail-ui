import { Meta, Story } from '@storybook/blocks';
import * as DocsStories from './ErrorMessages.docs.stories.tsx';

<Meta of={DocsStories} />

# Сообщения об ошибках

[Описание сообщения об ошибках в Контур.Гайдах](https://guides.kontur.ru/principles/validation/#Soobscheniya_ob_oshibkah)

По умолчанию сообщение об ошибке отображается в тултипе справа от контрола.
Это поведение переопределяется с помощью пропа `renderMessage` компонента `ValidationWrapper`.

```jsx static
    <ValidationWrapper validationInfo={...} renderMessage={...}>
      //...
    </ValidationWrapper>
```

## Тултипы

[Описание в Контур.Гайдах](https://guides.kontur.ru/principles/validation/#Tultipi)

Сообщение внутри тултипа рендерится с помощью функции `tooltip`.

Функция принимает один аргумент, который позволяет задать позицию отображения тултипа. Может принимать все значения, которые принимает проп `pos` компонента `Tooltip`.

Пример кода:

```jsx static
    <ValidationWrapper validationInfo={...} renderMessage={tooltip("top left")}>
      //...
    </ValidationWrapper>
```

### Пример

<Story of={DocsStories.TooltipValidation}></Story>

```jsx static
import React from 'react';
import { Input } from '@skbkontur/react-ui/components/Input';

import {
  ValidationContainer,
  ValidationWrapper,
  ValidationInfo,
  tooltip,
} from '../../../../src';
import { Nullable } from '../../../../typings/Types';
import { Form } from '../../../Common/Form';

interface TooltipValidationDemoState {
  value: string;
}

export default class TooltipValidationDemo extends React.Component {
  public state: TooltipValidationDemoState = {
    value: '',
  };

  public render() {
    const v = this.validate(this.state.value);
    return (
      <ValidationContainer>
        <Form>
          <Form.Line title="default">
            <ValidationWrapper validationInfo={v}>{this.renderInput()}</ValidationWrapper>
          </Form.Line>
          <Form.Line title="tooltip('right top')">
            <ValidationWrapper validationInfo={v} renderMessage={tooltip('right top')}>
              {this.renderInput()}
            </ValidationWrapper>
          </Form.Line>
          <Form.Line title="tooltip('top left')">
            <ValidationWrapper validationInfo={v} renderMessage={tooltip('top left')}>
              {this.renderInput()}
            </ValidationWrapper>
          </Form.Line>
        </Form>
      </ValidationContainer>
    );
  }

  private renderInput = () => {
    return (
      <Input
        placeholder={'Только цифры'}
        value={this.state.value}
        onValueChange={(value) => this.setState({ value })}
      />
    );
  };

  private validate = (value: string): Nullable<ValidationInfo> => {
    if (!/^\d*$/.test(value)) {
      return { message: 'Только цифры', type: 'lostfocus' };
    }
    return null;
  };
}
```

## Тексты

[Описание в Контур.Гайдах](https://guides.kontur.ru/principles/validation/#Krasnie_teksti_na_stranitse)

Текстовое сообщение рендерится с помощью функции `text`.

Функция принимает один аргумент, который позволяет задать позицию отображения текста. Если позициция не указана, позиция `right` будет установлена в качестве позиции по умолчанию. Возможные значения: `bottom | right`.

Пример кода:

```jsx static
    <ValidationWrapper
      validationInfo={...}
      renderMessage={text("bottom")}
    >
      //...
    </ValidationWrapper>
```

### Пример

<Story of={DocsStories.TextValidation}></Story>

```jsx static
import React from 'react';
import { Input } from '@skbkontur/react-ui/components/Input';

import {
  ValidationContainer,
  ValidationWrapper,
  ValidationInfo,
  text,
} from '../../../../src';
import { Nullable } from '../../../../typings/Types';
import { Form } from '../../../Common/Form';

export default class TextValidationDemo extends React.Component {
  public state = {
    value: '',
  };

  public render() {
    const v = this.validate(this.state.value);
    return (
      <ValidationContainer>
        <Form>
          <Form.Line title="text()">
            <ValidationWrapper validationInfo={v} renderMessage={text()}>
              {this.renderInput()}
            </ValidationWrapper>
          </Form.Line>
          <Form.Line title="text('right')">
            <ValidationWrapper validationInfo={v} renderMessage={text('right')}>
              {this.renderInput()}
            </ValidationWrapper>
          </Form.Line>
          <Form.Line title="text('bottom')">
            <ValidationWrapper validationInfo={v} renderMessage={text('bottom')}>
              {this.renderInput()}
            </ValidationWrapper>
          </Form.Line>
        </Form>
      </ValidationContainer>
    );
  }

  private renderInput = () => {
    return (
      <Input
        placeholder={'Только цифры'}
        value={this.state.value}
        onValueChange={(value) => this.setState({ value })}
      />
    );
  };

  private validate = (value: string): Nullable<ValidationInfo> => {
    if (!/^\d*$/.test(value)) {
      return { message: 'Только цифры', type: 'lostfocus' };
    }
    return null;
  };
}
```
