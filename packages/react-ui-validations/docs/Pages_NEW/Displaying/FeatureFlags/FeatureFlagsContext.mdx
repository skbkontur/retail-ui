import { Meta } from '@storybook/blocks';
import { Link } from '@skbkontur/react-ui/components/Link';
import { linkTo } from '@storybook/addon-links';
import { Story } from '@storybook/blocks';
import * as FeatureFlagsStories from './FeatureFlags.docs.stories';

<Meta title="Displaying/Feature flags" />

# Feature flags

Фича-флаги позволяют заранее применять будущие **breaking changes** (ломающие изменения) до выхода очередного мажорного релиза библииотеки.

При выходе очередной мажорной версии, например, `2.x.x` → `3.x.x`, будет применено новое поведение, а сами фича-флаги будут удалены.

## Подключение фича-флагов

Чтобы применить доработку/исправление нужно указать фича-флаги в `<ValidationsFeatureFlagsContext.Provider>`

```jsx static
import { ValidationsFeatureFlagsContext } from '@skbkontur/react-ui-validations';

function ExampleComponent() {
  return (
    <ValidationsFeatureFlagsContext.Provider
      value={{
        validationWrapperValidateOnMount: true,
        hideTooltipOnSelectionControls: true,
        dropdownsDoNotOpenOnFocusByValidation: true,
      }}
    >
      {/* Внутри будут работать все фича-флаги с true */}
    </ValidationsFeatureFlagsContext.Provider>
  );
}
```

Механизм работы: новая функциональность применяется или не применяется в зависимости от того, был ли передан со значением true соответствующий флаг или нет.

Флаги задаются с помощью `ValidationsFeatureFlagsContext.Provider`.

```jsx static
import { ValidationsFeatureFlagsContext } from '@skbkontur/react-ui-validations';

<ValidationsFeatureFlagsContext.Provider value={{ flagName: true }}>
  {/* ... */}
</ValidationsFeatureFlagsContext.Provider>;
```

## Список фича-флагов

### validationWrapperValidateOnMount

Поля отображают актуальное состояние валидации даже после их перемонтирования. Например, после переключения вкладок внутри формы, которая уже была провалидирована.

<Story of={FeatureFlagsStories.ValidateOnMount} />

### hideTooltipOnSelectionControlsFlag

В контролах c выбором значений (RadioGroup, Radio, CheckBox, Toggle, Switcher, Select, ComboBox) после выбора значения будет скрываться сообщение с валидацией

#### Selection Controls

<Story of={FeatureFlagsStories.ExampleSelection} />

### dropdownsDoNotOpenOnFocusByValidation

В случае получения фокуса из валидации формы, на контролах <Link onClick={linkTo('Input data/ComboBox')}>ComboBox</Link>, <Link onClick={linkTo('Input data/DatePicker')}>DatePicker</Link> автоматически не откроется popup.

#### Combobox

<Story of={FeatureFlagsStories.ExampleCombobox} />

#### DatePicker

<Story of={FeatureFlagsStories.ExampleDatePicker} />

## Объект со всеми флагами

Чтобы получить объект со всеми флагами, необходимо применить вспомогательную функцию getFullValidationsFlagsContext к объекту заданных флагов:

```jsx static
import { getFullValidationsFlagsContext } from '@skbkontur/react-ui-validtions';

getFullValidationsFlagsContext(useContext(ValidationsFeatureFlagsContext));
```
